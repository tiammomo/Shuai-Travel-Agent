# 产品需求文档 (PRD)

## 小帅旅游助手 - 智能AI旅游推荐系统

---

## 1. 项目概述

### 1.1 产品定位

小帅旅游助手是一款基于自定义 ReAct Agent 架构的智能旅游推荐系统，为用户提供城市推荐、景点查询、路线规划等一站式旅游咨询服务。

### 1.2 目标用户

- 有旅行计划但不确定目的地的用户
- 需要特定城市旅游攻略的用户
- 希望获取个性化旅行建议的用户

### 1.3 核心价值

- **智能推荐**：基于用户需求智能推荐旅游目的地
- **深度思考**：展示 AI 推理过程，增加用户信任感
- **实时交互**：流式响应，提供流畅的对话体验
- **多轮对话**：支持上下文感知的连续对话

---

## 2. 功能需求

### 2.1 核心功能

| 功能模块 | 功能描述 | 优先级 |
|---------|---------|--------|
| 智能对话 | 用户输入旅游需求，AI 进行理解和回复 | P0 |
| 深度思考展示 | 折叠式展示 AI 思考过程 | P0 |
| 流式响应 | Token 级别实时输出，流畅的逐字显示 | P0 |
| 多会话管理 | 支持多个独立对话历史 | P1 |
| 模型切换 | 支持切换不同 LLM 模型 | P1 |
| 城市信息查询 | 提供城市、景点、地区信息 | P2 |

### 2.2 对话模式

#### 2.2.1 Direct 模式（直接回答）

直接回答用户问题，不经过 ReAct 推理循环。

**适用场景**：
- 简单问题（如"北京有哪些景点"）
- 闲聊类问题
- 明确意图的查询

#### 2.2.2 ReAct 模式（标准模式）

完整的 ReAct 推理循环：思考 → 行动 → 观察 → 评估。

**适用场景**：
- 需要工具调用的复杂问题
- 多步骤规划任务
- 需要深入分析的场景

**ReAct 阶段流程**：

```
阶段一：理解任务
    ├── 解析用户意图
    └── 提取关键实体（城市、预算、天数等）

阶段二：制定计划
    ├── 制定执行步骤
    └── 确定所需工具

阶段三：执行工具
    ├── 调用工具获取信息
    └── 观察结果并评估

阶段四：生成回答
    ├── 整合工具结果
    └── 生成最终回复
```

#### 2.2.3 Plan 模式（规划模式）

结构化输出执行计划，分步骤展示。

**适用场景**：
- 长途旅行规划
- 多日行程安排
- 复杂行程规划

### 2.3 动态风格系统

| 风格名称 | 特点 | 适用场景 |
|---------|------|---------|
| 热情活泼 | 使用积极词汇、感叹号、丰富 Emoji | 年轻用户、休闲旅游 |
| 温暖亲切 | 柔和语气、关怀用词 | 家庭出行、亲子游 |
| 专业正式 | 严谨措辞、结构化输出 | 商务出行、详细攻略 |
| 俏皮可爱 | 萌系表达、趣味emoji | 年轻女性用户 |
| 简洁明了 | 精炼语言、重点突出 | 老龄用户、快速查询 |

### 2.4 意图识别系统

支持 17+ 种细粒度意图类型：

1. `city_recommendation` - 城市推荐
2. `attraction_query` - 景点查询
3. `itinerary_planning` - 行程规划
4. `food_recommendation` - 美食推荐
5. `accommodation_guide` - 住宿指南
6. `transportation_info` - 交通信息
7. `budget_planning` - 预算规划
8. `seasonal_advice` - 季节建议
9. `travel_tips` - 旅行贴士
10. `cultural_experience` - 文化体验
11. `shopping_guide` - 购物指南
12. `photography_spots` - 拍照地点
13. `outdoor_activities` - 户外活动
14. `family_travel` - 家庭游
15. `honeymoon_travel` - 蜜月游
16. `solo_travel` - 独自旅行
17. `group_travel` - 团队游

---

## 3. 非功能需求

### 3.1 性能需求

| 指标 | 要求 |
|-----|------|
| 首次响应时间 | < 3秒 |
| Token 输出间隔 | 80-100ms |
| 并发会话数 | > 10 |
| 可用性 | 99% |

### 3.2 兼容性需求

- **浏览器**：Chrome 90+, Firefox 88+, Safari 14+, Edge 90+
- **移动端**：iOS 14+, Android 10+
- **API**：RESTful API，SSE 流式传输

### 3.3 安全需求

- API Key 安全存储
- 输入内容过滤
- 会话数据隔离

---

## 4. 用户交互设计

### 4.1 界面布局

```
┌─────────────────────────────────────────────────────┐
│  Header: Logo + 标题 + 模型选择器                    │
├──────────┬──────────────────────────────────────────┤
│          │  消息列表区域                             │
│  侧边栏  │  ┌─────────────────────────────────────┐ │
│  ─────── │  │ 思考过程框 (可折叠)                  │ │
│          │  └─────────────────────────────────────┘ │
│  会话列表 │  ┌─────────────────────────────────────┐ │
│          │  │ 助手回复                             │ │
│  新建按钮│  └─────────────────────────────────────┘ │
│          │  ┌─────────────────────────────────────┐ │
│          │  │ 用户消息                             │ │
│          │  └─────────────────────────────────────┘ │
│          │                                          │
├──────────┴──────────────────────────────────────────┤
│  Footer: 输入框 + 发送按钮 + 停止按钮               │
└─────────────────────────────────────────────────────┘
```

### 4.2 交互流程

1. **新建会话**
   - 用户点击"新建会话"按钮
   - 系统创建空白会话并切换

2. **发送消息**
   - 用户输入内容并发送
   - 系统显示思考过程
   - 流式输出回复内容
   - 用户可随时点击"停止"中断

3. **切换会话**
   - 点击侧边栏会话列表项
   - 系统加载对应会话历史

4. **折叠思考过程**
   - 点击思考框标题栏
   - 展开/折叠详细内容

---

## 5. 技术架构

### 5.1 系统架构

```
┌─────────────────────────────────────────────────────┐
│                   前端 (Next.js 16)                  │
│       React 19 + TypeScript + Zustand + antd 6      │
└─────────────────────────────────────────────────────┘
                          │
                          ▼ HTTP + SSE
┌─────────────────────────────────────────────────────┐
│                  Web API (FastAPI)                   │
│                   端口: 48081                        │
└─────────────────────────────────────────────────────┘
                          │
                          ▼ gRPC
┌─────────────────────────────────────────────────────┐
│                Agent Service (gRPC)                  │
│                   端口: 50051                        │
│         自定义 ReAct 引擎 + MiniMax M2.1             │
└─────────────────────────────────────────────────────┘
```

### 5.2 技术栈

| 层级 | 技术选型 | 版本要求 |
|-----|---------|---------|
| 前端框架 | Next.js | 16.x |
| 前端语言 | TypeScript | 5.x |
| UI 组件库 | antd | 6.x |
| 状态管理 | Zustand | 4.x |
| 后端框架 | FastAPI | 0.100+ |
| Agent 引擎 | 自定义 ReAct | - |
| LLM | MiniMax M2.1 | - |
| 通信协议 | gRPC | - |

---

## 6. 数据模型

### 6.1 会话 (Session)

| 字段 | 类型 | 说明 |
|-----|------|------|
| session_id | string | 会话唯一标识 |
| name | string | 会话名称 |
| messages | Message[] | 消息历史 |
| message_count | int | 消息数量 |
| model_id | string | 使用的模型ID |
| created_at | datetime | 创建时间 |
| last_active | datetime | 最后活跃时间 |

### 6.2 消息 (Message)

| 字段 | 类型 | 说明 |
|-----|------|------|
| role | string | 角色 (user/assistant) |
| content | string | 消息内容 |
| timestamp | datetime | 时间戳 |
| reasoning | string | 思考过程 (可选) |

---

## 7. 版本规划

### v3.2.0 (当前版本)

- [x] ReAct Agent 步骤分层优化
- [x] Plan 模式阶段优化
- [x] 文档重构
- [x] MiniMax M2.1 集成

### v3.3.0 (待规划)

- [ ] 数据库持久化
- [ ] 用户认证系统
- [ ] 旅行攻略导出功能
- [ ] 收藏夹功能

---

## 8. 验收标准

### 功能验收

- [ ] 用户可以正常发送消息并收到回复
- [ ] 思考过程可以正确折叠/展开
- [ ] 流式输出流畅无卡顿
- [ ] 多会话切换正常
- [ ] 模型切换正常生效

### 性能验收

- [ ] 首次响应 < 3秒
- [ ] 页面加载 < 2秒
- [ ] 无内存泄漏

### 兼容性验收

- [ ] Chrome 最新版本正常
- [ ] 移动端响应式布局正常
